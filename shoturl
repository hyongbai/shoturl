#!/bin/bash
#TODO check http://

source  url-util

function    sina_short()
{
    if [ $1 ]; then
        APP_KEY="2483680040"
        #sina shorten url api
        API_ADDR="http://api.t.sina.com.cn/short_url/shorten.json?source=$APP_KEY&url_long=$1"
        #get result from sina shorten url api
        result=`curl "$API_ADDR" 2>/dev/null`
        #get shorten url from result
        shorturl=`echo $result|awk -F\" '{print $4}'`
        echo $shorturl
    fi
}

function    baidu_short()
{
    if [ $1 ]; then
        result=`curl dwz.cn/create.php -d "url=$1" 2>/dev/null`
        shorturl=`echo $result|awk -F\" '{print $4}'`
        echo $shorturl
    fi
}

function    google_short()
{
    if [ $1 ]; then  
        param="{\"longUrl\": \"$1\"}"
        result=`curl   https://www.googleapis.com/urlshortener/v1/url -H 'Content-Type: application/json' -d "$param" 2>/dev/null`
        shorturl=`echo $result | grep "\"id\"\:" | awk -F"\"id\"\:" '{print $2}' | awk -F"\," '{print $1}' | awk -F"\"" '{print $2}'`
        echo $shorturl
    fi
}


if [ $1 ]; then
    #remove http(s)://
    prefix="http"
    longurl=`echo "$1" | sed 's/^https:\/\///'`
    
    if [ $1 == "https://$longurl" ]; then
        prefix="https"
    else
        longurl=`echo "$longurl" | sed 's/^http:\/\///'`
    fi
    #longurl=`urlencode  '$longurl'`
    longurl="$prefix"://"$longurl"

    echo
    echo "----------------------------------------------------------"
    #sina shorten
    sina=`sina_short        $longurl`
    echo -e "sina        \033[;33;1m$sina\033[0m"

    #baidu shorten
    #bd=`baidu_short         $longurl`
    #echo -e "baidu       \033[;33;1m$bd\033[0m"

    #google shorten
    google=`google_short    $longurl`
    echo -e "google      \033[;33;1m$google\033[0m"
    echo "----------------------------------------------------------"
    echo 
    echo
else
    echo "PLEASE INPUT URL"
fi



